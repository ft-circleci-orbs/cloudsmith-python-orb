description:
  Generates a pip index url string which is assigned to the CLOUDSMITH_PIP_INDEX_URL environment variable.

  Depends on authenticate-with-oidc.
parameters:
  repository_identifier:
    description: The identity/slug of the Cloudsmith repository
    type: string
  service_identifier:
    description: The identity/slug of the Cloudsmith service account to use when authenticating with OIDC
    type: string
steps:
  - authenticate_with_oidc:
      service_identifier: <<parameters.service_identifier>>
  - run:
      name: Prepare script parameters
      command: |
        echo "export CLOUDSMITH_REPOSITORY_IDENTIFIER=\"<<parameters.repository_identifier>>\"" >> $BASH_ENV
  - run:
      name: Set environment variables for pip
      command: <<include(scripts/set_env_vars_for_pip.sh)>>
