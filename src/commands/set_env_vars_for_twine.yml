description:
  Generate temporary Cloudsmith credentials using OIDC and construct a repository URL for a specific Cloudsmith
  repository and service account. On completion the command sets the CLOUDSMITH_TWINE_REPOSITORY_URL,
  CLOUDSMITH_TWINE_USERNAME and CLOUDSMITH_TWINE_PASSWORD environment variables for use with twine.
parameters:
  repository:
    description: The identity/slug of the Cloudsmith repository
    type: string
  service_account:
    description: The identity/slug of the Cloudsmith service account to use when authenticating with OIDC
    type: string
steps:
  - authenticate_with_oidc:
      service_account: <<parameters.service_account>>
  - run:
      name: Cloudsmith - Configure domains
      command: <<include(scripts/configure_cloudsmith_domains.sh)>>
  - run:
      name: Cloudsmith - Configure repository
      command: |
        echo "export CLOUDSMITH_REPOSITORY=\"<<parameters.repository>>\"" >> $BASH_ENV
        echo "CLOUDSMITH_REPOSITORY=<<parameters.repository>>"
  - run:
      name: Cloudsmith - Set CLOUDSMITH_TWINE environment variables
      command: <<include(scripts/set_env_vars_for_twine.sh)>>
